<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping Pongg</title>

    <!-- Estilo básico do canvas -->
    <style>
        #quadro {
            border: 2px solid #000;
            background: rgb(0, 0, 0);
            display: block;
            margin: 0 auto;
        }
    </style>

    <!-- Inclusão do jQuery (versão slim) -->
    <script src="https://code.jquery.com/jquery-3.7.1.slim.js"
        integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
</head>

<body>

    <!-- Canvas onde o jogo será desenhado -->
    <canvas id="quadro" width="1000" height="600"></canvas>

    <script>
        // Aguarda o carregamento da página para executar o código
        $().ready(function () {
            var canvas = $("#quadro")[0];
            var ctx = canvas.getContext("2d"); // contexto 2D para desenhar no canvas

            var colisao = false; // controle de colisão (usado para evitar múltiplas inversões)
            var start = false
            var gameover = false 

            // Jogador 1 (lado esquerdo)
            var p1 = {
                "vx": 0,
                "vy": 0,
                "x": canvas.width / 2 - 60,
                "y": 500,
                "l": 120, // largura
                "a": 10, // altura
                "cor": "white",

                // Atualiza a posição com base na velocidade
                atualiza: function () {
                    this.x += this.vx;
                    this.y += this.vy;
                },

                // Desenha o jogador 1 no canvas
                desenharObjeto: function () {
                    ctx.fillStyle = this.cor;
                    ctx.fillRect(this.x, this.y, this.l, this.a);
                }
            }

            // Objeto bolinha
            var bolinha = {
                "vx": 0,
                "vy": 0,
                "x": canvas.width / 2,
                "y": 475,
                "raio": 8,
                "cor": "white",

                atualiza: function () {
                    this.x += this.vx;
                    this.y += this.vy;
                },

                desenharObjeto: function () {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.raio, 0, Math.PI * 2);
                    ctx.fillStyle = this.cor;
                    ctx.fill();
                    ctx.closePath();
                }
            };
            

            // Detecta colisão entre bolinha (círculo) e jogador (retângulo)
            function detectaColisaoCQ(bolinha, p) {
                let maisProximoX = Math.max(p.x, Math.min(bolinha.x, p.x + p.l));
                let maisProximoY = Math.max(p.y, Math.min(bolinha.y, p.y + p.a));

                let distX = bolinha.x - maisProximoX;
                let distY = bolinha.y - maisProximoY;
                let distancia = Math.sqrt(distX * distX + distY * distY);

                if (distancia < bolinha.raio) {
                    colisao = true;
                    bolinha.vy *= -1; // inverte direção vertical da bolinha
                } else {
                    colisao = false;
                }
            }

            // Reinicia posição e direção da bolinha após pontuação
            function reiniciaBolinha() {
                bolinha.x = canvas.width / 2;
                bolinha.y = canvas.height / 2;

                // Gera direção aleatória
                bolinha.vx = Math.random() > 0.5 ? 3 : -3;
                bolinha.vy = Math.random() > 0.5 ? 3 : -3;
            }

            // Função principal que desenha tudo a cada frame
            function desenharTela() {

                apagarTela();

                // Atualiza e desenha jogador 1
               
                if(start==false){
                    bolinha.vx=p1.vx;
                }
               
                p1.atualiza();
                detectaLimite(p1);
                p1.desenharObjeto();


                // Atualiza e desenha bolinha
                bolinha.atualiza();
                detectaLimite(bolinha);
                bolinha.desenharObjeto();

                // Verifica colisão com os jogadores
                detectaColisaoCQ(bolinha, p1);

                // Chama a próxima atualização da tela (loop infinito)
                requestAnimationFrame(desenharTela);
            }

            // Limita o movimento dos jogadores e a bolinha dentro da tela
            function detectaLimite(obj) {
                // Jogadores
                if (obj === p1) {
                    if (obj.x < 0) {
                        obj.x = 0;
                        obj.vx = 0;
                    }
                    if (obj.x + obj.l > canvas.width) {
                        obj.x = canvas.width - obj.l;
                        obj.vx = 0;
                    }
                }

                // Bolinha
                if (obj === bolinha) {
                    //bolinha.y + bolinha.raio > canvas.height -> borda inferior
                    // Rebater nas bordas superior/esquerda/direita
                    if (bolinha.y - bolinha.raio < 0) {
                        bolinha.vy *= -1;
                    }
                    if (bolinha.x - bolinha.raio < 0 || bolinha.x + bolinha.raio > canvas.width){
                        bolinha.vx *= -1;
                    }
                    if (bolinha.y > canvas.height) {
                        gameover = true
                    }
                }


            }

            // Limpa o canvas
            function apagarTela() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            // Inicia o loop do jogo
            desenharTela();

            // Controles do teclado - pressionar tecla
            $(window).keydown(function (event) {
                //console.log(event.which); //ver o numero da tecla
                if (event.which == 37) { // Seta cima (controle jogador 1)
                    p1.vx = -3;
                }
                if (event.which == 39) { // Seta baixo (controle jogador 1)
                    p1.vx = 3;
                }
                if (event.which == 32) { // Seta baixo (controle jogador 1)
                    if(start==false){
                        start=true;
                        bolinha.vx = -3
                        bolinha.vy = -3
                    }
                }

            });
        });
    </script>
</body>

</html>
